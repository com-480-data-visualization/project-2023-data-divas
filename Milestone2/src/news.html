<!DOCTYPE html>
<html>
  <style> @import url('https://fonts.cdnfonts.com/css/sensa-brush'); </style>
  <head>
    <title>Data Divas COM-480 Data Visualization Project</title>
    <meta charset="utf-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="index.css" />
    <style>
      /* Add some basic styling to the news items */
      .news-item {
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ccc;
      }
    </style>
  </head>

  <div class="navigation_bar">
    <a href="index.html">Home</a>
    <a href="howto.html">How To</a>
    <a class="active" href="news.html">News</a>
    <a href="about.html">About</a>
  </div>

  <link rel="stylesheet" href="index.css" />

  <br>
<body>
<h1 style="margin-bottom: 0px">Live news page</h1>
<div class="container">
  <hr>
  <div class="list-wrapper">
    <div class="row single-news">
      <div class="col-4">
        <img id="default-image" style="width:100%;" src="data/news.jpg">
      </div>
      <div class="col-8">
        <h2>Loading...</h2>
        <small>Loading...</small>
        <p>Loading...</p>
        <a href="#" class="btn btn-sm btn-primary" style="float:right;" target="_blank">Read More >></a>
      </div>
    </div>
  </div>
</div>

<script>
  // Make an AJAX request to fetch the news data from the News API
  var xhr = new XMLHttpRequest();
  var lastMonthDate = getLastMonthDate();
  console.log(lastMonthDate );
  var news_keyword = 'GHG'; // Specify the keyword for news search
  var api_key = '30a1600f7fd74a879509f2e26afb2b17'; // Replace with your actual News API key
  var api_url = 'https://newsapi.org/v2/everything?q=' + news_keyword + '&from=' + lastMonthDate  + '2023-04-30&sortBy=popularityAt&apiKey=' + api_key;
  xhr.open('GET', api_url, true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      var response = JSON.parse(xhr.responseText);
      var articles = response.articles.slice(0, 10);
      renderNews(articles);
    }
  };
  xhr.send();

  // Render the news data dynamically
  function renderNews(articles) {
  var listWrapper = document.querySelector('.list-wrapper');
  listWrapper.innerHTML = ''; // Clear the loading placeholder

  var displayedAuthors = []; // Array to store displayed authors

  for (var i = 0; i < articles.length; i++) {
    var news = articles[i];

    // Check if the image URL is available
    if (!news.urlToImage) {
      continue; // Skip this article if image URL is not available
    }

    var row = document.createElement('div');
    row.className = 'row single-news';

    var colImg = document.createElement('div');
    colImg.className = 'col-4';

    var img = document.createElement('img');
    img.className = 'news-image';
    img.src = news.urlToImage;
    img.onerror = function() {
      this.src = 'data/news.jpg'; // Replace with the URL of your default image
    };

    colImg.appendChild(img);

    var colContent = document.createElement('div');
    colContent.className = 'col-8';

    var title = document.createElement('h2');
    title.textContent = news.title;

    var source = document.createElement('small');
    source.className = 'source-name';
    source.textContent = news.source.name;

    var author = news.author; // Get the author from the news object

    if (displayedAuthors.includes(author)) {
      author = ''; // Set author to empty string if already displayed
    } else {
      displayedAuthors.push(author); // Add the author to the displayedAuthors array
    }

    var description = document.createElement('p');
    description.textContent = news.description;

    var link = document.createElement('a');
    link.href = news.url;
    link.className = 'btn btn-sm btn-primary';
    link.style.float = 'right';
    link.target = '_blank';
    link.textContent = 'Read More >>';

    colContent.appendChild(title);
    colContent.appendChild(source);

    if (author !== '') {
      var authorElem = document.createElement('small');
      authorElem.className = 'author';
      authorElem.textContent = author;
      colContent.appendChild(authorElem);
    }

    colContent.appendChild(description);
    colContent.appendChild(link);

    row.appendChild(colImg);
    row.appendChild(colContent);

    listWrapper.appendChild(row);
    }
  }

  function getLastMonthDate() {
  var currentDate = new Date(); // Get the current date
  var previousMonthDate = new Date(
    currentDate.getFullYear(),
    currentDate.getMonth() - 1,
    1
  ); // Set the date to the 1st of the previous month

  var daysInPreviousMonth = new Date(
    previousMonthDate.getFullYear(),
    previousMonthDate.getMonth() + 1,
    0
  ).getDate(); // Get the number of days in the previous month

  var previousMonth = new Date(
    previousMonthDate.getFullYear(),
    previousMonthDate.getMonth(),
    Math.min(currentDate.getDate(), daysInPreviousMonth)
  ); // Adjust the date if needed

  var year = previousMonth.getFullYear();
  var month = (previousMonth.getMonth() + 1).toString().padStart(2, '0');
  var day = previousMonth.getDate().toString().padStart(2, '0');

  var formattedDate = year + '-' + month + '-' + day;

  return formattedDate;
}
  </script>
</body>

    
